# åšå®¢ç½‘ç«™æ›´æ–°æŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„è¯´æ˜

```
/Users/wangjiaqiao/Desktop/blog/
â”œâ”€â”€ client/                     # å‰ç«¯ä»£ç 
â”œâ”€â”€ server/                     # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/                   # æºä»£ç 
â”‚   â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ articles.json      # åšå®¢æ–‡ç« æ•°æ®
â”‚   â”œâ”€â”€ documents/             # ğŸ“‹ æ–‡æ¡£æ–‡ä»¶å¤¹ (ä¸»è¦ä½¿ç”¨)
â”‚   â”‚   â””â”€â”€ *.typ              # Typst æ–‡æ¡£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ *.md               # Markdown æ–‡æ¡£æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/               # ä¸Šä¼ æ–‡ä»¶å¤¹ (ç³»ç»Ÿç”¨)
â”‚   â”‚   â””â”€â”€ documents/         # âš ï¸ ç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹
â”‚   â””â”€â”€ compiled/              # ç¼–è¯‘è¾“å‡ºæ–‡ä»¶å¤¹ (ç³»ç»Ÿç”¨)
â””â”€â”€ ç½‘ç«™æ›´æ–°æŒ‡å—.md             # æœ¬æ–‡ä»¶
```

## ğŸ¯ æ–‡æ¡£è·¯å¾„è¯´æ˜

### ä¸»è¦æ–‡æ¡£ç›®å½•ï¼ˆæ‚¨éœ€è¦å…³æ³¨çš„ï¼‰
- **ğŸ“‹ `/server/documents/`**
  - **ç”¨é€”**: å­˜æ”¾æ‚¨çš„æ–‡æ¡£æ–‡ä»¶
  - **æ”¯æŒæ ¼å¼**: `.typ` (Typst), `.md` (Markdown)
  - **æ“ä½œ**: ç›´æ¥æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶

### ç³»ç»Ÿç›®å½•ï¼ˆè‡ªåŠ¨ç®¡ç†ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹ï¼‰
- **âš™ï¸ `/server/uploads/documents/`**
  - **ç”¨é€”**: ç³»ç»Ÿä¸Šä¼ åŠŸèƒ½çš„ä¸´æ—¶å­˜å‚¨
  - **æ³¨æ„**: ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹

- **âš™ï¸ `/server/compiled/`**
  - **ç”¨é€”**: Typst æ–‡ä»¶ç¼–è¯‘åçš„ PDF å­˜å‚¨
  - **æ³¨æ„**: ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå’Œæ¸…ç†

## ğŸ“ å¦‚ä½•æ›´æ–°ç½‘ç«™å†…å®¹

### 1. æ·»åŠ æ–°çš„åšå®¢æ–‡ç« 

**æ–¹æ³•ä¸€: ç›´æ¥ç¼–è¾‘æ•°æ®æ–‡ä»¶**
```bash
# ç¼–è¾‘æ–‡ç« æ•°æ®æ–‡ä»¶
/server/data/articles.json
```

åœ¨æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æ–‡ç« å¯¹è±¡ï¼š
```json
{
  "id": "unique-id-here",
  "title": "æ–‡ç« æ ‡é¢˜",
  "content": "æ–‡ç« å†…å®¹ (æ”¯æŒ Markdown æˆ– Typst æ ¼å¼)",
  "category": "blog|skills|projects",
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"],
  "author": "ä½œè€…å",
  "excerpt": "æ–‡ç« æ‘˜è¦",
  "images": [],
  "createdAt": "2025-01-01T00:00:00.000Z",
  "updatedAt": "2025-01-01T00:00:00.000Z"
}
```

### 2. æ·»åŠ æ–°çš„æ–‡æ¡£

**æ­¥éª¤:**
1. å°†æ–‡æ¡£æ–‡ä»¶æ”¾å…¥ `/server/documents/` æ–‡ä»¶å¤¹
2. æ”¯æŒçš„æ–‡ä»¶æ ¼å¼:
   - `.typ` - Typst æ–‡æ¡£ï¼ˆä¼šè‡ªåŠ¨ç¼–è¯‘ä¸º PDF é¢„è§ˆï¼‰
   - `.md` - Markdown æ–‡æ¡£

**ç¤ºä¾‹:**
```bash
# å¤åˆ¶æ–‡æ¡£åˆ°æ­£ç¡®ä½ç½®
cp ~/Desktop/æˆ‘çš„æ–‡æ¡£.typ /Users/wangjiaqiao/Desktop/blog/server/documents/
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/wangjiaqiao/Desktop/blog

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

æœåŠ¡å™¨å¯åŠ¨å:
- å‰ç«¯: http://localhost:3001
- åç«¯: http://localhost:5001

## ğŸ”„ æ–‡æ¡£è‡ªåŠ¨å¤„ç†

### Typst æ–‡æ¡£ (.typ)
- âœ… è‡ªåŠ¨ç¼–è¯‘ä¸º PDF
- âœ… æä¾› PDF é¢„è§ˆ
- âœ… æ˜¾ç¤ºæºä»£ç 
- âœ… æ”¯æŒä¸‹è½½

### Markdown æ–‡æ¡£ (.md)
- âœ… è‡ªåŠ¨æ¸²æŸ“ä¸º HTML
- âœ… æ”¯æŒä»£ç é«˜äº®
- âœ… æ”¯æŒä¸‹è½½

## ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

## ğŸ“‹ æ—¥å¸¸ç»´æŠ¤æ£€æŸ¥æ¸…å•

### æ¯æ¬¡æ·»åŠ å†…å®¹æ—¶:
- [ ] ç¡®è®¤æ–‡ä»¶æ”¾åœ¨æ­£ç¡®çš„ç›®å½• (`/server/documents/`)
- [ ] æ£€æŸ¥æ–‡ä»¶åæ²¡æœ‰ç‰¹æ®Šå­—ç¬¦
- [ ] æµ‹è¯•æ–‡æ¡£åœ¨ç½‘ç«™ä¸Šæ­£å¸¸æ˜¾ç¤º
- [ ] ç¡®è®¤ PDF ç¼–è¯‘æ­£å¸¸ï¼ˆå¯¹äº .typ æ–‡ä»¶ï¼‰

### å®šæœŸæ¸…ç†:
- [ ] æ¸…ç† `/server/compiled/` ä¸­çš„ä¸´æ—¶ PDF æ–‡ä»¶
- [ ] æ£€æŸ¥ `/server/uploads/` ä¸­æ˜¯å¦æœ‰ä¸å¿…è¦çš„æ–‡ä»¶

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **åªåœ¨ `/server/documents/` ä¸­æ·»åŠ æ–‡æ¡£æ–‡ä»¶**
2. **ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ `/server/uploads/` ä¸­çš„æ–‡ä»¶**
3. **å¤‡ä»½ `/server/data/articles.json` æ–‡ä»¶**
4. **Typst æ–‡ä»¶éœ€è¦æœ‰æ•ˆçš„è¯­æ³•æ‰èƒ½æ­£ç¡®ç¼–è¯‘**

## ğŸ› ï¸ æ•…éšœæ’é™¤

### Typst æ–‡æ¡£ä¸èƒ½ç¼–è¯‘
```bash
# æ£€æŸ¥ Typst æ˜¯å¦å®‰è£…
typst --version

# æ‰‹åŠ¨æµ‹è¯•ç¼–è¯‘
typst compile /path/to/document.typ
```

### æ–‡æ¡£ä¸æ˜¾ç¤º
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®ç›®å½•
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. é‡å¯å¼€å‘æœåŠ¡å™¨

### æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :3001
lsof -i :5001

# æ¸…ç† node_modules å¹¶é‡æ–°å®‰è£…
rm -rf node_modules
npm install
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
3. ç¡®è®¤æ–‡ä»¶è·¯å¾„å’Œæƒé™æ­£ç¡®

## ğŸ”§ é«˜çº§ç»´æŠ¤æ“ä½œ

### æ•°æ®åº“ç»´æŠ¤
```bash
# æ–‡ç« æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
node -e "
const data = require('./server/data/articles.json');
data.forEach((article, index) => {
  if (!article.id || !article.title || !article.content) {
    console.log(\`é—®é¢˜æ–‡ç«  \${index}: \${article.title || 'Unknown'}\`);
  }
});
"

# æ¸…ç†é‡å¤æ–‡ç« ID
node -e "
const fs = require('fs');
const data = require('./server/data/articles.json');
const ids = new Set();
const cleaned = data.filter(article => {
  if (ids.has(article.id)) {
    console.log(\`ç§»é™¤é‡å¤æ–‡ç« : \${article.title}\`);
    return false;
  }
  ids.add(article.id);
  return true;
});
fs.writeFileSync('./server/data/articles.json', JSON.stringify(cleaned, null, 2));
"
```

### æ–‡ä»¶ç³»ç»Ÿç»´æŠ¤
```bash
# æ£€æŸ¥å­¤ç«‹æ–‡ä»¶ï¼ˆæ²¡æœ‰è¢«æ–‡ç« å¼•ç”¨çš„å›¾ç‰‡ï¼‰
find server/uploads/images -name "*.jpg" -o -name "*.png" -o -name "*.webp" | while read file; do
  basename_file=$(basename "$file")
  if ! grep -r "$basename_file" server/data/articles.json > /dev/null; then
    echo "å­¤ç«‹æ–‡ä»¶: $file"
  fi
done

# æ¸…ç†è¿‡æœŸçš„ç¼–è¯‘æ–‡ä»¶ï¼ˆ7å¤©å‰çš„ï¼‰
find server/compiled -name "*.pdf" -mtime +7 -delete

# æ£€æŸ¥æ–‡æ¡£ç›®å½•æƒé™
ls -la server/documents/
chmod 755 server/documents/
chmod 644 server/documents/*.typ 2>/dev/null || true
```

### æ€§èƒ½ä¼˜åŒ–
```bash
# å‹ç¼©å›¾ç‰‡æ–‡ä»¶ï¼ˆéœ€è¦å®‰è£… imagemagickï¼‰
find server/uploads/images -name "*.jpg" -exec mogrify -quality 85 {} \;
find server/uploads/images -name "*.png" -exec mogrify -quality 95 {} \;

# æ£€æŸ¥å¤§æ–‡ä»¶
find server/ -size +10M -ls

# ç›‘æ§å†…å­˜ä½¿ç”¨
ps aux | grep node | awk '{print $4, $11}' | sort -nr
```

### è‡ªåŠ¨åŒ–è„šæœ¬

#### åˆ›å»ºå¤‡ä»½è„šæœ¬
```bash
# åˆ›å»º backup.sh
cat > backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="$HOME/backups/blog"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

echo "å¼€å§‹å¤‡ä»½åšå®¢æ•°æ®..."

# å¤‡ä»½æ–‡ç« æ•°æ®
cp server/data/articles.json "$BACKUP_DIR/articles_$DATE.json"

# å¤‡ä»½æ–‡æ¡£æ–‡ä»¶
cp -r server/documents "$BACKUP_DIR/documents_$DATE"

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
cp -r server/uploads "$BACKUP_DIR/uploads_$DATE"

# åˆ›å»ºå‹ç¼©åŒ…
cd "$BACKUP_DIR"
tar -czf "blog_backup_$DATE.tar.gz" articles_$DATE.json documents_$DATE uploads_$DATE
rm -rf articles_$DATE.json documents_$DATE uploads_$DATE

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/blog_backup_$DATE.tar.gz"

# æ¸…ç†30å¤©å‰çš„å¤‡ä»½
find "$BACKUP_DIR" -name "blog_backup_*.tar.gz" -mtime +30 -delete
EOF

chmod +x backup.sh
```

#### åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
```bash
# åˆ›å»º health_check.sh
cat > health_check.sh << 'EOF'
#!/bin/bash

echo "=== åšå®¢ç³»ç»Ÿå¥åº·æ£€æŸ¥ ==="
echo "æ—¶é—´: $(date)"
echo

# æ£€æŸ¥è¿›ç¨‹
echo "1. æ£€æŸ¥æœåŠ¡è¿›ç¨‹:"
if pgrep -f "npm run dev" > /dev/null; then
    echo "âœ… å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ"
else
    echo "âŒ å¼€å‘æœåŠ¡å™¨æœªè¿è¡Œ"
fi

# æ£€æŸ¥ç«¯å£
echo -e "\n2. æ£€æŸ¥ç«¯å£çŠ¶æ€:"
if lsof -i:3001 > /dev/null 2>&1; then
    echo "âœ… å‰ç«¯ç«¯å£ 3001 æ­£å¸¸"
else
    echo "âŒ å‰ç«¯ç«¯å£ 3001 æœªç›‘å¬"
fi

if lsof -i:5001 > /dev/null 2>&1; then
    echo "âœ… åç«¯ç«¯å£ 5001 æ­£å¸¸"
else
    echo "âŒ åç«¯ç«¯å£ 5001 æœªç›‘å¬"
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
echo -e "\n3. æ£€æŸ¥ç£ç›˜ç©ºé—´:"
df -h server/ | tail -1 | awk '{print "ç£ç›˜ä½¿ç”¨ç‡:", $5}'

# æ£€æŸ¥æ–‡ä»¶æƒé™
echo -e "\n4. æ£€æŸ¥å…³é”®ç›®å½•æƒé™:"
ls -ld server/documents server/uploads server/data

# æ£€æŸ¥ Typst å®‰è£…
echo -e "\n5. æ£€æŸ¥ Typst:"
if command -v typst > /dev/null; then
    echo "âœ… Typst å·²å®‰è£…: $(typst --version)"
else
    echo "âŒ Typst æœªå®‰è£…"
fi

# æ£€æŸ¥æ–‡ç« æ•°æ®
echo -e "\n6. æ£€æŸ¥æ•°æ®æ–‡ä»¶:"
if [ -f server/data/articles.json ]; then
    ARTICLE_COUNT=$(node -e "console.log(require('./server/data/articles.json').length)")
    echo "âœ… æ–‡ç« æ•°æ®æ­£å¸¸ï¼Œå…± $ARTICLE_COUNT ç¯‡æ–‡ç« "
else
    echo "âŒ æ–‡ç« æ•°æ®æ–‡ä»¶ä¸¢å¤±"
fi

echo -e "\n=== æ£€æŸ¥å®Œæˆ ==="
EOF

chmod +x health_check.sh
```

## ğŸ“‹ ç»´æŠ¤æ£€æŸ¥æ¸…å•

### æ¯æ—¥æ£€æŸ¥
- [ ] è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬ï¼š`./health_check.sh`
- [ ] æŸ¥çœ‹å¼€å‘æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
- [ ] æ£€æŸ¥ç½‘ç«™æ˜¯å¦æ­£å¸¸è®¿é—®

### æ¯å‘¨æ£€æŸ¥
- [ ] å¤‡ä»½é‡è¦æ•°æ®ï¼š`./backup.sh`
- [ ] æ¸…ç†ä¸´æ—¶ç¼–è¯‘æ–‡ä»¶ï¼š`rm -rf server/compiled/*`
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- [ ] æ›´æ–°ç³»ç»ŸåŒ…ï¼š`npm outdated`

### æ¯æœˆæ£€æŸ¥
- [ ] å®Œæ•´ç³»ç»Ÿå¤‡ä»½
- [ ] æ£€æŸ¥å¹¶æ¸…ç†å­¤ç«‹æ–‡ä»¶
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼šå‹ç¼©å›¾ç‰‡æ–‡ä»¶
- [ ] å®‰å…¨æ£€æŸ¥ï¼šæŸ¥çœ‹å¼‚å¸¸è®¿é—®æ—¥å¿—

### å‘å¸ƒå‰æ£€æŸ¥
- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•ï¼š`npm test`ï¼ˆå¦‚æœæœ‰æµ‹è¯•ï¼‰
- [ ] æ£€æŸ¥æ‰€æœ‰é“¾æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ
- [ ] éªŒè¯ Typst æ–‡æ¡£ç¼–è¯‘æ­£å¸¸
- [ ] ç¡®è®¤æš—è‰²æ¨¡å¼æ˜¾ç¤ºæ­£å¸¸
- [ ] æµ‹è¯•å“åº”å¼è®¾è®¡åœ¨ä¸åŒè®¾å¤‡ä¸Šçš„è¡¨ç°

## ğŸš¨ ç´§æ€¥æ¢å¤ç¨‹åº

### ç³»ç»Ÿå´©æºƒæ¢å¤
1. **åœæ­¢æ‰€æœ‰æœåŠ¡**ï¼š`pkill -f "npm run dev"`
2. **æ£€æŸ¥ç«¯å£å ç”¨**ï¼š`lsof -i :3001 && lsof -i :5001`
3. **å¼ºåˆ¶æ¸…ç†è¿›ç¨‹**ï¼š`kill -9 $(lsof -ti:3001,5001)`
4. **æ¢å¤æ•°æ®**ï¼šä»æœ€è¿‘å¤‡ä»½æ¢å¤ `articles.json`
5. **é‡æ–°å®‰è£…ä¾èµ–**ï¼š`rm -rf node_modules && npm install`
6. **é‡æ–°å¯åŠ¨**ï¼š`npm run dev`

### æ•°æ®æŸåæ¢å¤
```bash
# 1. ç«‹å³åœæ­¢æœåŠ¡
pkill -f "npm run dev"

# 2. å¤‡ä»½æŸåæ–‡ä»¶
cp server/data/articles.json server/data/articles.json.corrupted

# 3. ä»å¤‡ä»½æ¢å¤
cp ~/backups/blog/articles_YYYYMMDD.json server/data/articles.json

# 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
node -e "console.log(require('./server/data/articles.json').length + ' articles loaded')"

# 5. é‡å¯æœåŠ¡
npm run dev
```

---

**æœ€åæ›´æ–°**: 2025å¹´9æœˆ22æ—¥
**ç‰ˆæœ¬**: 2.0
**ç»´æŠ¤æŒ‡å—ç‰ˆæœ¬**: v2.0.0